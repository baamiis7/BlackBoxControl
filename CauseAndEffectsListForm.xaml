<UserControl x:Class="BlackBoxControl.CauseAndEffectsListForm"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}"
             HorizontalAlignment="Stretch" 
             VerticalAlignment="Stretch">

  <ScrollViewer VerticalScrollBarVisibility="Auto" 
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="20">
    <StackPanel Orientation="Vertical">

      <!-- Header -->
      <Border Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,2"
                    Padding="0,0,0,15"
                    Margin="0,0,0,20">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <StackPanel Grid.Column="0">
            <TextBlock Text="Cause and Effects Manager" 
                                   FontSize="24" 
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource ForegroundBrush}"
                                   Margin="0,0,0,5"/>
            <TextBlock Text="Manage logical relationships between input and output devices" 
                                   FontSize="13"
                                   Foreground="{StaticResource ForegroundDimBrush}"/>
          </StackPanel>

          <Button Grid.Column="1"
                            Content="+ Add New C&amp;E"
                            Style="{StaticResource PrimaryButton}"
                            MinWidth="150"
                            Command="{Binding AddNewCauseEffectCommand}"
                            VerticalAlignment="Center"/>
        </Grid>
      </Border>

      <!-- Statistics Cards -->
      <Grid Margin="0,0,0,20">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Total C&E Card -->
        <Border Grid.Column="0" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource PrimaryBrush}"
                        BorderThickness="2"
                        CornerRadius="6"
                        Padding="15"
                        Margin="0,0,10,0">
          <StackPanel>
            <TextBlock Text="Total Entries" 
                                   FontSize="11"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   Margin="0,0,0,5"/>
            <TextBlock Text="{Binding TotalEntries}" 
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryBrush}"/>
          </StackPanel>
        </Border>

        <!-- Active C&E Card -->
        <Border Grid.Column="1" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource SuccessBrush}"
                        BorderThickness="2"
                        CornerRadius="6"
                        Padding="15"
                        Margin="0,0,10,0">
          <StackPanel>
            <TextBlock Text="Active" 
                                   FontSize="11"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   Margin="0,0,0,5"/>
            <TextBlock Text="{Binding ActiveEntries}" 
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource SuccessBrush}"/>
          </StackPanel>
        </Border>

        <!-- Inactive C&E Card -->
        <Border Grid.Column="2" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource ForegroundDimBrush}"
                        BorderThickness="2"
                        CornerRadius="6"
                        Padding="15"
                        Margin="0,0,10,0">
          <StackPanel>
            <TextBlock Text="Inactive" 
                                   FontSize="11"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   Margin="0,0,0,5"/>
            <TextBlock Text="{Binding InactiveEntries}" 
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource ForegroundDimBrush}"/>
          </StackPanel>
        </Border>

        <!-- Logic Gates Summary -->
        <Border Grid.Column="3" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource SecondaryBrush}"
                        BorderThickness="2"
                        CornerRadius="6"
                        Padding="15">
          <StackPanel>
            <TextBlock Text="Most Used Gate" 
                                   FontSize="11"
                                   Foreground="{StaticResource ForegroundDimBrush}"
                                   Margin="0,0,0,5"/>
            <TextBlock Text="{Binding MostUsedGate}" 
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource SecondaryBrush}"/>
          </StackPanel>
        </Border>
      </Grid>

      <!-- Search and Filter Bar -->
      <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="15"
                    Margin="0,0,0,20">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <!-- Search Box -->
          <Border Grid.Column="0"
                            Background="{StaticResource BackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="10"
                            Margin="0,0,10,0">
            <Grid>
              <TextBox Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Padding="0"/>
              <TextBlock Text="ðŸ” Search cause and effects..."
                                       Foreground="{StaticResource ForegroundDimBrush}"
                                       IsHitTestVisible="False"
                                       Margin="2,0,0,0">
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding SearchText}" Value="">
                        <Setter Property="Visibility" Value="Visible"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </Grid>
          </Border>

          <!-- Filter by Status -->
          <ComboBox Grid.Column="1"
                              Style="{StaticResource ModernDarkComboBox}"
                              SelectedItem="{Binding FilterStatus, Mode=TwoWay}"
                              MinWidth="120"
                              Margin="0,0,10,0">
            <ComboBoxItem Content="All Status"/>
            <ComboBoxItem Content="Active"/>
            <ComboBoxItem Content="Inactive"/>
          </ComboBox>

          <!-- Filter by Logic Gate -->
          <ComboBox Grid.Column="2"
                              Style="{StaticResource ModernDarkComboBox}"
                              SelectedItem="{Binding FilterLogicGate, Mode=TwoWay}"
                              MinWidth="120">
            <ComboBoxItem Content="All Gates"/>
            <ComboBoxItem Content="OR"/>
            <ComboBoxItem Content="AND"/>
            <ComboBoxItem Content="XOR"/>
          </ComboBox>
        </Grid>
      </Border>

      <!-- C&E Entries List -->
      <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="15">

        <StackPanel>
          <TextBlock Text="Configured Entries" 
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource PrimaryBrush}"
                               Margin="0,0,0,15"/>

          <!-- Empty State -->
          <Border Padding="40"
                            Background="{StaticResource BackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="6">
            <Border.Style>
              <Style TargetType="Border">
                <Setter Property="Visibility" Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding CauseEffects.Count}" Value="0">
                    <Setter Property="Visibility" Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>

            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
              <TextBlock Text="âš¡" 
                                       FontSize="64"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,10"
                                       Opacity="0.3"/>
              <TextBlock Text="No Cause and Effect Entries Yet" 
                                       FontSize="18"
                                       FontWeight="Medium"
                                       Foreground="{StaticResource ForegroundBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,5"/>
              <TextBlock Text="Click 'Add New C&amp;E' to create your first entry" 
                                       FontSize="13"
                                       Foreground="{StaticResource ForegroundDimBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,20"/>
              <Button Content="+ Create First Entry"
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding AddNewCauseEffectCommand}"/>
            </StackPanel>
          </Border>

          <!-- C&E List -->
          <ItemsControl ItemsSource="{Binding CauseEffects}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Background="{StaticResource BackgroundBrush}"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Padding="15"
                                        Margin="0,0,0,10">
                  <Border.Style>
                    <Style TargetType="Border">
                      <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                          <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                          <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                        </Trigger>
                      </Style.Triggers>
                    </Style>
                  </Border.Style>

                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- C&E Icon and Status -->
                    <StackPanel Grid.Column="0" 
                                                    Orientation="Vertical" 
                                                    Margin="0,0,15,0"
                                                    VerticalAlignment="Center">
                      <TextBlock Text="âš¡" 
                                                       FontSize="32"
                                                       HorizontalAlignment="Center"/>
                      <Border Background="{StaticResource SuccessBrush}"
                                                    CornerRadius="3"
                                                    Padding="6,2"
                                                    Margin="0,5,0,0">
                        <Border.Style>
                          <Style TargetType="Border">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding CauseEffect.IsEnabled}" Value="False">
                                <Setter Property="Background" Value="{StaticResource ForegroundDimBrush}"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </Border.Style>
                        <TextBlock Text="{Binding CauseEffect.Status}" 
                                                           FontSize="10"
                                                           Foreground="White"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center"/>
                      </Border>
                    </StackPanel>

                    <!-- C&E Details -->
                    <StackPanel Grid.Column="1">
                      <TextBlock Text="{Binding CauseEffect.Name}" 
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource ForegroundBrush}"
                                                       Margin="0,0,0,8"/>

                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="Auto"/>
                          <ColumnDefinition Width="Auto"/>
                          <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Inputs -->
                        <Border Grid.Column="0"
                                                        Background="#1A0078D4"
                                                        BorderBrush="{StaticResource SecondaryBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        Margin="0,0,10,0">
                          <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥ " FontSize="12"/>
                            <TextBlock FontSize="11" Foreground="{StaticResource ForegroundBrush}">
                                                            <Run Text="{Binding InputCount, Mode=OneWay}" FontWeight="Bold"/>
                                                            <Run Text=" input(s)"/>
                            </TextBlock>
                          </StackPanel>
                        </Border>

                        <!-- Logic Gate -->
                        <Border Grid.Column="1"
                                                        Background="#1AF39C12"
                                                        BorderBrush="{StaticResource WarningBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        Margin="0,0,10,0">
                          <TextBlock FontSize="11" Foreground="{StaticResource ForegroundBrush}">
                                                        <Run Text="âš™" FontWeight="Bold"/>
                                                        <Run Text="{Binding CauseEffect.LogicGate}" FontWeight="Bold"/>
                          </TextBlock>
                        </Border>

                        <!-- Outputs -->
                        <Border Grid.Column="2"
                                                        Background="#1A03DAC6"
                                                        BorderBrush="{StaticResource SuccessBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="8,4">
                          <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¤ " FontSize="12"/>
                            <TextBlock FontSize="11" Foreground="{StaticResource ForegroundBrush}">
                                                            <Run Text="{Binding OutputCount, Mode=OneWay}" FontWeight="Bold"/>
                                                            <Run Text=" output(s)"/>
                            </TextBlock>
                          </StackPanel>
                        </Border>
                      </Grid>

                      <!-- Description -->
                      <TextBlock Margin="0,8,0,0"
                                                       FontSize="12"
                                                       Foreground="{StaticResource ForegroundDimBrush}"
                                                       TextWrapping="Wrap">
                                                <Run Text="When "/>
                                                <Run Text="{Binding InputCount, Mode=OneWay}" FontWeight="Bold"/>
                                                <Run Text=" input device(s) trigger with "/>
                                                <Run Text="{Binding CauseEffect.LogicGate}" FontWeight="Bold"/>
                                                <Run Text=" logic â†’ activate "/>
                                                <Run Text="{Binding OutputCount, Mode=OneWay}" FontWeight="Bold"/>
                                                <Run Text=" output device(s)"/>
                      </TextBlock>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="2" 
                                                    Orientation="Vertical"
                                                    VerticalAlignment="Center">
                      <Button Content="Edit"
                                                    Style="{StaticResource SecondaryButton}"
                                                    MinWidth="80"
                                                    Margin="0,0,0,5"
                                                    Command="{Binding DataContext.EditCauseEffectCommand, 
                                                            RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"/>
                      <Button Content="Delete"
                                                    Style="{StaticResource SecondaryButton}"
                                                    MinWidth="80"
                                                    Margin="0,0,0,5"
                                                    Command="{Binding DataContext.DeleteCauseEffectCommand, 
                                                            RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}">
                      </Button>
                      <Button Content="Test"
                                                    Style="{StaticResource SecondaryButton}"
                                                    MinWidth="80"
                                                    Command="{Binding DataContext.TestCauseEffectCommand, 
                                                            RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"/>
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </Border>

    </StackPanel>
  </ScrollViewer>
</UserControl>
